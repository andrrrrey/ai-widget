diff --git a/widget/widget.css b/widget/widget.css
index b554318d466f18bdef356d4c95ed991071ecd801..53e76e879f57a95a64b0bdfba2f6a3fa092aaebf 100644
--- a/widget/widget.css
+++ b/widget/widget.css
@@ -104,50 +104,51 @@
 
 .aiw-hero{
   display:flex;
   flex-direction:column;
   align-items:center;
   justify-content:flex-start;
   gap: 14px;
   padding-top: 48px;
   flex: 0 0 auto;
   pointer-events:none;
 }
 
 .aiw-sparkle{ width:40px;height:40px;color:#0f0f10;opacity:.95; }
 .aiw-title{ font-size: clamp(22px, 2.2vw, 34px); font-weight: 500; letter-spacing:.2px; }
 
 .aiw-chat{
   flex: 1 1 auto;
   min-height: 0;
   display:flex;
   flex-direction:column;
   justify-content:flex-end;
   gap: 18px;
   padding: 10px 0 6px;
   overflow-y:auto;
   overflow-x:hidden;
+  scroll-behavior: smooth;
   scrollbar-width: none;
 }
 
 .aiw-chat::-webkit-scrollbar{width:0;height:0}
 
 .aiw-msg{ display:flex; flex-direction:column; gap: 8px; max-width: 774px; }
 .aiw-msg.aiw-left{ align-self:flex-start; }
 .aiw-msg.aiw-right{ align-self:flex-end; }
 
 .aiw-label{ font-size: 12px; letter-spacing: .08em; color: var(--aiw-muted); padding: 0 10px; }
 
 .aiw-bubble{
   background: var(--aiw-bubble-bg);
   border: 1px solid var(--aiw-bubble-border);
   border-radius: 12px;
   padding: 14px 16px;
   backdrop-filter: blur(10px);
   -webkit-backdrop-filter: blur(10px);
   width: fit-content;
   max-width: 648px;
 }
 
 .aiw-msg.aiw-left .aiw-bubble{ border-top-left-radius: 8px; }
 .aiw-msg.aiw-right .aiw-bubble{ border-top-right-radius: 8px; }
 
diff --git a/widget/widget.js b/widget/widget.js
index 9e09f996eb91d06a2f8ffc689adf5394e191a22f..00615d068acc889a323180f9ccc72b4ddfd4477d 100644
--- a/widget/widget.js
+++ b/widget/widget.js
@@ -57,94 +57,126 @@
 
       <div class="aiw-composerWrap">
         <form class="aiw-composer" id="aiw-form" role="group" aria-label="Message composer">
           <input class="aiw-input" id="aiw-input" placeholder="Ask me anything about your projects" autocomplete="off"/>
           <button class="aiw-send" type="submit" aria-label="Send">
             <svg viewBox="0 0 24 24" fill="none" stroke="rgba(130,140,155,.95)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
               <path d="M22 2L11 13" />
               <path d="M22 2L15 22l-4-9-9-4 20-7z" />
             </svg>
           </button>
         </form>
       </div>
     </div>
   `;
 
   document.body.appendChild(btn);
   document.body.appendChild(overlay);
   document.body.appendChild(overlayClose);
   document.body.appendChild(panel);
 
   const form = panel.querySelector("#aiw-form");
   const input = panel.querySelector("#aiw-input");
   const msgs = panel.querySelector("#aiw-msgs");
   const statusEl = panel.querySelector("#aiw-status");
 
+  let renderedCount = 0;
+  let shouldAutoScroll = true;
+
   function setStatus(text) {
     statusEl.textContent = text || "";
   }
 
-  function append(role, text) {
+  function isAtBottom() {
+    const threshold = 24;
+    return msgs.scrollHeight - msgs.scrollTop - msgs.clientHeight <= threshold;
+  }
+
+  function scrollToBottom(useSmooth = true) {
+    msgs.scrollTo({ top: msgs.scrollHeight, behavior: useSmooth ? "smooth" : "auto" });
+  }
+
+  function append(role, text, opts = {}) {
+    const stickToBottom = opts.forceScroll || shouldAutoScroll;
     const item = document.createElement("div");
     const isUser = role === "user";
     item.className = "aiw-msg " + (isUser ? "aiw-right" : "aiw-left");
 
     const label = document.createElement("div");
     label.className = "aiw-label";
     label.textContent = isUser ? "ME" : role === "human" ? "OPERATOR" : "OUR AI";
 
     const bubble = document.createElement("div");
     bubble.className = "aiw-bubble";
     const p = document.createElement("p");
     p.textContent = text;
     bubble.appendChild(p);
 
     item.appendChild(label);
     item.appendChild(bubble);
 
     msgs.appendChild(item);
-    msgs.scrollTop = msgs.scrollHeight;
+    renderedCount++;
+    if (stickToBottom) scrollToBottom(true);
     return p;
   }
 
   async function ensureChat() {
     if (chatId) return chatId;
     const r = await fetch(`${BASE}/api/widget/${projectId}/chat/start`, {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify({ visitorId }),
     });
     const j = await r.json();
     if (!r.ok) throw new Error(j?.error || "start_failed");
     chatId = j.chatId;
     return chatId;
   }
 
   function renderMessages(items) {
-    msgs.innerHTML = "";
-    items.forEach((item) => append(item.role, item.content));
-    msgs.scrollTop = msgs.scrollHeight;
+    const wasAtBottom = isAtBottom();
+
+    if (msgs.children.length > items.length) {
+      msgs.innerHTML = "";
+      renderedCount = 0;
+    }
+
+    items.forEach((item, idx) => {
+      const existing = msgs.children[idx];
+      if (existing) {
+        const bubbleText = existing.querySelector(".aiw-bubble p");
+        if (bubbleText && bubbleText.textContent !== item.content) {
+          bubbleText.textContent = item.content;
+        }
+      } else {
+        append(item.role, item.content, { forceScroll: wasAtBottom });
+      }
+    });
+
+    renderedCount = items.length;
+    if (wasAtBottom) scrollToBottom(true);
   }
 
   let pollTimer = null;
   let pollInFlight = false;
 
   async function syncMessages() {
     if (!chatId || pollInFlight) return;
     pollInFlight = true;
     try {
       const r = await fetch(`${BASE}/api/widget/${projectId}/chat/${chatId}/messages`);
       if (!r.ok) throw new Error("messages_failed");
       const j = await r.json();
       if (Array.isArray(j.items)) renderMessages(j.items);
     } catch (e) {
       console.warn("syncMessages failed", e);
     } finally {
       pollInFlight = false;
     }
   }
 
   function startPollingMessages() {
     if (pollTimer) return;
     pollTimer = setInterval(syncMessages, 2000);
   }
 
@@ -156,51 +188,51 @@
 
   async function sendMessage(text) {
     await ensureChat();
 
     append("user", text);
     input.value = "";
     input.focus();
 
     setStatus("Печатает…");
 
     // Stream assistant via SSE
     const url = `${BASE}/api/widget/${projectId}/chat/${chatId}/stream?message=${encodeURIComponent(text)}`;
     const es = new EventSource(url, { withCredentials: true });
 
     let assistantText = null;
     let acc = "";
 
     es.addEventListener("token", (e) => {
       const data = JSON.parse(e.data);
       const t = data.t || "";
       if (!assistantText) {
         assistantText = append("assistant", "");
       }
       acc += t;
       assistantText.textContent = acc;
-      msgs.scrollTop = msgs.scrollHeight;
+      if (shouldAutoScroll) scrollToBottom(true);
     });
 
     es.addEventListener("waiting_for_human", () => {
       setStatus("Оператор подключился. Подождите, пожалуйста…");
       startPollingMessages();
     });
 
     es.addEventListener("error", (e) => {
       try {
         const data = JSON.parse(e.data);
         setStatus("Ошибка: " + (data.message || "unknown"));
       } catch {
         setStatus("Ошибка");
       }
       es.close();
     });
 
     es.addEventListener("done", () => {
       setStatus("");
       es.close();
     });
   }
 
   async function openPanel() {
     isOpen = true;
@@ -227,34 +259,38 @@
     setTimeout(() => btn.classList.remove("aiw-hide"), 200);
   }
 
   btn.addEventListener("click", async () => {
     if (isOpen) {
       closePanel();
     } else {
       await openPanel();
     }
   });
 
   overlayClose.addEventListener("click", closePanel);
 
   form.addEventListener("submit", async (e) => {
     e.preventDefault();
     const text = String(input.value || "").trim();
     if (!text) return;
     try {
       await sendMessage(text);
     } catch (err) {
       console.error(err);
       setStatus("Не удалось отправить сообщение");
     }
   });
 
+  msgs.addEventListener("scroll", () => {
+    shouldAutoScroll = isAtBottom();
+  });
+
   function escapeHtml(s) {
     return String(s)
       .replaceAll("&", "&amp;")
       .replaceAll("<", "&lt;")
       .replaceAll(">", "&gt;")
       .replaceAll('"', "&quot;")
       .replaceAll("'", "&#039;");
   }
 })();
